"use strict";(self.webpackChunknextjs=self.webpackChunknextjs||[]).push([[176],{8453:(n,e,i)=>{i.d(e,{R:()=>t,x:()=>d});var r=i(6540);const c={},s=r.createContext(c);function t(n){const e=r.useContext(s);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function d(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(c):n.components||c:t(n.components),r.createElement(s.Provider,{value:e},n.children)}},8889:(n,e,i)=>{i.r(e),i.d(e,{assets:()=>l,contentTitle:()=>d,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>o});const r=JSON.parse('{"id":"crud/evaluation-query-operators","title":"Evaluation Query Operators","description":"1. Gi\u1edbi thi\u1ec7u","source":"@site/docs/crud/evaluation-query-operators.md","sourceDirName":"crud","slug":"/crud/evaluation-query-operators","permalink":"/mongodb/crud/evaluation-query-operators","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":11,"frontMatter":{"sidebar_position":11},"sidebar":"tutorialSidebar","previous":{"title":"Element Query Operators","permalink":"/mongodb/crud/element-query-operator"},"next":{"title":"findOneAnd...","permalink":"/mongodb/crud/findOneAnd"}}');var c=i(4848),s=i(8453);const t={sidebar_position:11},d="Evaluation Query Operators",l={},o=[{value:"1. Gi\u1edbi thi\u1ec7u",id:"1-gi\u1edbi-thi\u1ec7u",level:2},{value:"2. C\xe1c Evaluation Query Operators",id:"2-c\xe1c-evaluation-query-operators",level:2},{value:"<code>$regex</code> - Bi\u1ec3u th\u1ee9c ch\xednh quy (Regular Expression)",id:"regex---bi\u1ec3u-th\u1ee9c-ch\xednh-quy-regular-expression",level:3},{value:"<code>$text</code> - T\xecm ki\u1ebfm v\u0103n b\u1ea3n (Text Search)",id:"text---t\xecm-ki\u1ebfm-v\u0103n-b\u1ea3n-text-search",level:3},{value:"<code>$where</code> - Bi\u1ec3u th\u1ee9c JavaScript",id:"where---bi\u1ec3u-th\u1ee9c-javascript",level:3},{value:"<code>$expr</code> - Bi\u1ec3u th\u1ee9c Aggregation",id:"expr---bi\u1ec3u-th\u1ee9c-aggregation",level:3},{value:"<code>$mod</code> - Ph\xe9p chia l\u1ea5y d\u01b0 (Modulo)",id:"mod---ph\xe9p-chia-l\u1ea5y-d\u01b0-modulo",level:3}];function a(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,s.R)(),...n.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(e.header,{children:(0,c.jsx)(e.h1,{id:"evaluation-query-operators",children:"Evaluation Query Operators"})}),"\n",(0,c.jsx)(e.h2,{id:"1-gi\u1edbi-thi\u1ec7u",children:"1. Gi\u1edbi thi\u1ec7u"}),"\n",(0,c.jsxs)(e.p,{children:[(0,c.jsx)(e.strong,{children:"Evaluation Query Operators"})," l\xe0 c\xe1c to\xe1n t\u1eed truy v\u1ea5n cho ph\xe9p ta th\u1ef1c hi\u1ec7n c\xe1c ",(0,c.jsx)(e.strong,{children:"ph\xe9p \u0111\xe1nh gi\xe1 n\xe2ng cao"})," tr\xean d\u1eef li\u1ec7u, bao g\u1ed3m: bi\u1ec3u th\u1ee9c ch\xednh quy, bi\u1ec3u th\u1ee9c JavaScript, t\xecm ki\u1ebfm v\u0103n b\u1ea3n, v\xe0 c\xe1c ph\xe9p so s\xe1nh ph\u1ee9c t\u1ea1p kh\xe1c. C\xe1c to\xe1n t\u1eed n\xe0y cung c\u1ea5p kh\u1ea3 n\u0103ng linh ho\u1ea1t cao cho c\xe1c truy v\u1ea5n ph\u1ee9c t\u1ea1p."]}),"\n",(0,c.jsx)(e.h2,{id:"2-c\xe1c-evaluation-query-operators",children:"2. C\xe1c Evaluation Query Operators"}),"\n",(0,c.jsxs)(e.h3,{id:"regex---bi\u1ec3u-th\u1ee9c-ch\xednh-quy-regular-expression",children:[(0,c.jsx)(e.code,{children:"$regex"})," - Bi\u1ec3u th\u1ee9c ch\xednh quy (Regular Expression)"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["To\xe1n t\u1eed ",(0,c.jsx)(e.code,{children:"$regex"})," cung c\u1ea5p kh\u1ea3 n\u0103ng so kh\u1edbp m\u1eabu (pattern matching) s\u1eed d\u1ee5ng bi\u1ec3u th\u1ee9c ch\xednh quy."]}),"\n",(0,c.jsxs)(e.li,{children:["C\xfa ph\xe1p:","\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:"{ field: { $regex: /pattern/, $options: '<options>' } }\n// ho\u1eb7c\n{ field: { $regex: 'pattern', $options: '<options>' } }\n"})}),"\n"]}),"\n"]}),"\n",(0,c.jsx)(e.p,{children:(0,c.jsx)(e.strong,{children:"C\xe1c options ph\u1ed5 bi\u1ebfn:"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.code,{children:"i"})," - Kh\xf4ng ph\xe2n bi\u1ec7t hoa th\u01b0\u1eddng"]}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.code,{children:"m"})," - Multi-line matching"]}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.code,{children:"x"})," - B\u1ecf qua whitespace"]}),"\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.code,{children:"s"})," - Cho ph\xe9p dot (.) kh\u1edbp v\u1edbi t\u1ea5t c\u1ea3 k\xfd t\u1ef1"]}),"\n"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"V\xed d\u1ee5:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:'// T\xecm users c\xf3 email k\u1ebft th\xfac b\u1eb1ng @gmail.com\ndb.users.find({\n  email: {\n    $regex: /@gmail\\.com$/,\n  },\n});\n\n// T\xecm products c\xf3 name ch\u1ee9a "laptop" (kh\xf4ng ph\xe2n bi\u1ec7t hoa th\u01b0\u1eddng)\ndb.products.find({\n  name: {\n    $regex: /laptop/i,\n  },\n});\n\n// T\xecm documents c\xf3 description b\u1eaft \u0111\u1ea7u b\u1eb1ng "Premium"\ndb.products.find({\n  description: {\n    $regex: /^Premium/,\n  },\n});\n\n// S\u1eed d\u1ee5ng string pattern thay v\xec regex literal\ndb.users.find({\n  name: {\n    $regex: "^Nguy\u1ec5n",\n    $options: "i",\n  },\n});\n'})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"V\xed d\u1ee5 n\xe2ng cao:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:"// T\xecm phone numbers theo \u0111\u1ecbnh d\u1ea1ng Vi\u1ec7t Nam\ndb.users.find({\n  phone: {\n    $regex: /^(\\\\+84|0)[1-9][0-9]{8}$/,\n  },\n});\n\n// T\xecm emails h\u1ee3p l\u1ec7\ndb.users.find({\n  email: {\n    $regex: /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$/,\n  },\n});\n\n// T\xecm usernames ch\u1ec9 ch\u1ee9a ch\u1eef c\xe1i v\xe0 s\u1ed1\ndb.users.find({\n  username: {\n    $regex: /^[a-zA-Z0-9]+$/,\n  },\n});\n"})}),"\n",(0,c.jsxs)(e.h3,{id:"text---t\xecm-ki\u1ebfm-v\u0103n-b\u1ea3n-text-search",children:[(0,c.jsx)(e.code,{children:"$text"})," - T\xecm ki\u1ebfm v\u0103n b\u1ea3n (Text Search)"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["To\xe1n t\u1eed ",(0,c.jsx)(e.code,{children:"$text"})," th\u1ef1c hi\u1ec7n t\xecm ki\u1ebfm v\u0103n b\u1ea3n tr\xean c\xe1c tr\u01b0\u1eddng \u0111\u01b0\u1ee3c index d\u1ea1ng text."]}),"\n",(0,c.jsx)(e.li,{children:"C\xfa ph\xe1p:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:"{\n  $text: {\n    $search: <string>,\n    $language: <string>,\n    $caseSensitive: <boolean>,\n    $diacriticSensitive: <boolean>\n  }\n}\n"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"V\xed d\u1ee5:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:'// T\u1ea1o text index tr\u01b0\u1edbc\ndb.products.createIndex({\n  name: "text",\n  description: "text",\n});\n\n// T\xecm ki\u1ebfm products ch\u1ee9a t\u1eeb "laptop" ho\u1eb7c "computer"\ndb.products.find({\n  $text: {\n    $search: "laptop computer",\n  },\n});\n\n// T\xecm ki\u1ebfm c\u1ee5m t\u1eeb "gaming laptop"\ndb.products.find({\n  $text: {\n    $search: \'"gaming laptop"\',\n  },\n});\n\n// T\xecm ki\u1ebfm v\u1edbi lo\u1ea1i tr\u1eeb t\u1eeb\ndb.products.find({\n  $text: {\n    $search: "laptop -used", // T\xecm laptop nh\u01b0ng lo\u1ea1i tr\u1eeb used\n  },\n});\n\n// T\xecm ki\u1ebfm v\u1edbi ng\xf4n ng\u1eef c\u1ee5 th\u1ec3\ndb.articles.find({\n  $text: {\n    $search: "database",\n    $language: "en",\n  },\n});\n'})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:(0,c.jsx)(e.strong,{children:"Text search v\u1edbi scoring:"})}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:'// T\xecm ki\u1ebfm v\xe0 s\u1eafp x\u1ebfp theo relevance score\ndb.products\n  .find(\n    {\n      $text: {\n        $search: "wireless mouse",\n      },\n    },\n    {\n      score: {\n        $meta: "textScore",\n      },\n    }\n  )\n  .sort({\n    score: {\n      $meta: "textScore",\n    },\n  });\n'})}),"\n",(0,c.jsxs)(e.h3,{id:"where---bi\u1ec3u-th\u1ee9c-javascript",children:[(0,c.jsx)(e.code,{children:"$where"})," - Bi\u1ec3u th\u1ee9c JavaScript"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["To\xe1n t\u1eed ",(0,c.jsx)(e.code,{children:"$where"})," cho ph\xe9p s\u1eed d\u1ee5ng bi\u1ec3u th\u1ee9c JavaScript \u0111\u1ec3 truy v\u1ea5n documents."]}),"\n",(0,c.jsx)(e.li,{children:"C\xfa ph\xe1p:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:"{ $where: <javascript expression> }\n"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"V\xed d\u1ee5:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:'// T\xecm users c\xf3 name v\xe0 username gi\u1ed1ng nhau\ndb.users.find({\n  $where: "this.name === this.username",\n});\n\n// T\xecm products c\xf3 discount > 50%\ndb.products.find({\n  $where:\n    "this.originalPrice > 0 && (this.originalPrice - this.price) / this.originalPrice > 0.5",\n});\n\n// T\xecm orders c\xf3 t\u1ed5ng items kh\u1edbp v\u1edbi total\ndb.orders.find({\n  $where: function () {\n    let calculatedTotal = 0;\n    this.items.forEach((item) => {\n      calculatedTotal += item.price * item.quantity;\n    });\n    return Math.abs(calculatedTotal - this.total) < 0.01;\n  },\n});\n'})}),"\n",(0,c.jsx)(e.admonition,{title:"L\u01b0u \xfd quan tr\u1ecdng",type:"caution",children:(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:[(0,c.jsx)(e.code,{children:"$where"})," ch\u1eadm h\u01a1n c\xe1c to\xe1n t\u1eed kh\xe1c v\xec ph\u1ea3i execute JavaScript"]}),"\n",(0,c.jsxs)(e.li,{children:["Kh\xf4ng s\u1eed d\u1ee5ng ",(0,c.jsx)(e.code,{children:"$where"})," n\u1ebfu c\xf3 th\u1ec3 d\xf9ng c\xe1c to\xe1n t\u1eed kh\xe1c"]}),"\n",(0,c.jsx)(e.li,{children:"Lu\xf4n k\u1ebft h\u1ee3p v\u1edbi c\xe1c \u0111i\u1ec1u ki\u1ec7n kh\xe1c \u0111\u1ec3 gi\u1ea3m s\u1ed1 l\u01b0\u1ee3ng documents c\u1ea7n x\u1eed l\xfd"}),"\n"]})}),"\n",(0,c.jsxs)(e.h3,{id:"expr---bi\u1ec3u-th\u1ee9c-aggregation",children:[(0,c.jsx)(e.code,{children:"$expr"})," - Bi\u1ec3u th\u1ee9c Aggregation"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["To\xe1n t\u1eed ",(0,c.jsx)(e.code,{children:"$expr"})," cho ph\xe9p s\u1eed d\u1ee5ng c\xe1c bi\u1ec3u th\u1ee9c aggregation trong truy v\u1ea5n."]}),"\n",(0,c.jsx)(e.li,{children:"C\xfa ph\xe1p:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:"{ $expr: { <expression> } }\n"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"V\xed d\u1ee5:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:'// T\xecm orders c\xf3 total > subtotal + tax\ndb.orders.find({\n  $expr: {\n    $gt: ["$total", { $add: ["$subtotal", "$tax"] }],\n  },\n});\n\n// T\xecm users c\xf3 n\u0103m sinh = 1990\ndb.users.find({\n  $expr: {\n    $eq: [{ $year: "$birthDate" }, 1990],\n  },\n});\n\n// T\xecm products c\xf3 gi\xe1 khuy\u1ebfn m\xe3i < 50% gi\xe1 g\u1ed1c\ndb.products.find({\n  $expr: {\n    $lt: ["$salePrice", { $multiply: ["$originalPrice", 0.5] }],\n  },\n});\n\n// So s\xe1nh gi\u1eefa hai tr\u01b0\u1eddng trong c\xf9ng document\ndb.employees.find({\n  $expr: {\n    $gt: ["$salary", "$budget"],\n  },\n});\n'})}),"\n",(0,c.jsxs)(e.h3,{id:"mod---ph\xe9p-chia-l\u1ea5y-d\u01b0-modulo",children:[(0,c.jsx)(e.code,{children:"$mod"})," - Ph\xe9p chia l\u1ea5y d\u01b0 (Modulo)"]}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsxs)(e.li,{children:["To\xe1n t\u1eed ",(0,c.jsx)(e.code,{children:"$mod"})," th\u1ef1c hi\u1ec7n ph\xe9p chia l\u1ea5y d\u01b0 tr\xean c\xe1c tr\u01b0\u1eddng s\u1ed1."]}),"\n",(0,c.jsx)(e.li,{children:"C\xfa ph\xe1p:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:"{\n  field: {\n    $mod: [divisor, remainder];\n  }\n}\n"})}),"\n",(0,c.jsxs)(e.ul,{children:["\n",(0,c.jsx)(e.li,{children:"V\xed d\u1ee5:"}),"\n"]}),"\n",(0,c.jsx)(e.pre,{children:(0,c.jsx)(e.code,{className:"language-js",children:"// T\xecm products c\xf3 price chia h\u1ebft cho 10\ndb.products.find({\n  price: {\n    $mod: [10, 0],\n  },\n});\n\n// T\xecm users c\xf3 age l\u1ebb\ndb.users.find({\n  age: {\n    $mod: [2, 1],\n  },\n});\n\n// T\xecm orders c\xf3 orderId chia 5 d\u01b0 2\ndb.orders.find({\n  orderId: {\n    $mod: [5, 2],\n  },\n});\n"})})]})}function h(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,c.jsx)(e,{...n,children:(0,c.jsx)(a,{...n})}):a(n)}}}]);