"use strict";(self.webpackChunknextjs=self.webpackChunknextjs||[]).push([[576],{5145:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>d,toc:()=>r});const d=JSON.parse('{"id":"crud/update-replace-document","title":"Update v\xe0 Replace document","description":"Gi\u1edbi thi\u1ec7u","source":"@site/docs/crud/update-replace-document.md","sourceDirName":"crud","slug":"/crud/update-replace-document","permalink":"/mongodb/crud/update-replace-document","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":4,"frontMatter":{"sidebar_position":4},"sidebar":"tutorialSidebar","previous":{"title":"Ch\xe8n document","permalink":"/mongodb/crud/insert-document"},"next":{"title":"X\xf3a document","permalink":"/mongodb/crud/delete-document"}}');var i=t(4848),c=t(8453);const s={sidebar_position:4},a="Update v\xe0 Replace document",l={},r=[{value:"Gi\u1edbi thi\u1ec7u",id:"gi\u1edbi-thi\u1ec7u",level:2},{value:"Replace document",id:"replace-document",level:2},{value:"<code>replaceOne()</code> - Thay th\u1ebf m\u1ed9t document",id:"replaceone---thay-th\u1ebf-m\u1ed9t-document",level:3},{value:"Update document",id:"update-document",level:2},{value:"<code>updateOne()</code> - C\u1eadp nh\u1eadt m\u1ed9t document",id:"updateone---c\u1eadp-nh\u1eadt-m\u1ed9t-document",level:3},{value:"<code>updateMany()</code> - C\u1eadp nh\u1eadt nhi\u1ec1u documents",id:"updatemany---c\u1eadp-nh\u1eadt-nhi\u1ec1u-documents",level:3},{value:"C\xe1c to\xe1n t\u1eed update quan tr\u1ecdng",id:"c\xe1c-to\xe1n-t\u1eed-update-quan-tr\u1ecdng",level:2},{value:"<code>$set</code> - Thi\u1ebft l\u1eadp gi\xe1 tr\u1ecb tr\u01b0\u1eddng",id:"set---thi\u1ebft-l\u1eadp-gi\xe1-tr\u1ecb-tr\u01b0\u1eddng",level:3},{value:"<code>$unset</code> - X\xf3a tr\u01b0\u1eddng",id:"unset---x\xf3a-tr\u01b0\u1eddng",level:3},{value:"<code>$inc</code> - T\u0103ng/gi\u1ea3m gi\xe1 tr\u1ecb s\u1ed1",id:"inc---t\u0103nggi\u1ea3m-gi\xe1-tr\u1ecb-s\u1ed1",level:3},{value:"<code>$mul</code> - Nh\xe2n gi\xe1 tr\u1ecb",id:"mul---nh\xe2n-gi\xe1-tr\u1ecb",level:3},{value:"<code>$rename</code> - \u0110\u1ed5i t\xean tr\u01b0\u1eddng",id:"rename---\u0111\u1ed5i-t\xean-tr\u01b0\u1eddng",level:3},{value:"<code>$min</code> v\xe0 <code>$max</code>",id:"min-v\xe0-max",level:3},{value:"To\xe1n t\u1eed update v\u1edbi m\u1ea3ng",id:"to\xe1n-t\u1eed-update-v\u1edbi-m\u1ea3ng",level:2},{value:"<code>$push</code> - Th\xeam ph\u1ea7n t\u1eed v\xe0o m\u1ea3ng",id:"push---th\xeam-ph\u1ea7n-t\u1eed-v\xe0o-m\u1ea3ng",level:3},{value:"<code>$addToSet</code> - Th\xeam ph\u1ea7n t\u1eed n\u1ebfu ch\u01b0a t\u1ed3n t\u1ea1i",id:"addtoset---th\xeam-ph\u1ea7n-t\u1eed-n\u1ebfu-ch\u01b0a-t\u1ed3n-t\u1ea1i",level:3},{value:"<code>$pull</code> - X\xf3a ph\u1ea7n t\u1eed kh\u1ecfi m\u1ea3ng",id:"pull---x\xf3a-ph\u1ea7n-t\u1eed-kh\u1ecfi-m\u1ea3ng",level:3},{value:"<code>$pop</code> - X\xf3a ph\u1ea7n t\u1eed \u0111\u1ea7u/cu\u1ed1i m\u1ea3ng",id:"pop---x\xf3a-ph\u1ea7n-t\u1eed-\u0111\u1ea7ucu\u1ed1i-m\u1ea3ng",level:3},{value:"<code>arrayFilters</code> - L\u1ecdc ph\u1ea7n t\u1eed trong m\u1ea3ng",id:"arrayfilters---l\u1ecdc-ph\u1ea7n-t\u1eed-trong-m\u1ea3ng",level:3}];function o(n){const e={admonition:"admonition",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,c.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"update-v\xe0-replace-document",children:"Update v\xe0 Replace document"})}),"\n",(0,i.jsx)(e.h2,{id:"gi\u1edbi-thi\u1ec7u",children:"Gi\u1edbi thi\u1ec7u"}),"\n",(0,i.jsx)(e.admonition,{type:"info",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Update v\xe0 Replace"})," l\xe0 c\xe1c thao t\xe1c quan tr\u1ecdng \u0111\u1ec3 s\u1eeda \u0111\u1ed5i d\u1eef li\u1ec7u hi\u1ec7n c\xf3 trong MongoDB. C\xf3 hai c\xe1ch ti\u1ebfp c\u1eadn ch\xednh:","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Replace"})," : Thay th\u1ebf to\xe0n b\u1ed9 document"]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"Update"})," : S\u1eeda \u0111\u1ed5i m\u1ed9t ph\u1ea7n document s\u1eed d\u1ee5ng c\xe1c to\xe1n t\u1eed update"]}),"\n"]}),"\n"]}),"\n"]})}),"\n",(0,i.jsx)(e.h2,{id:"replace-document",children:"Replace document"}),"\n",(0,i.jsxs)(e.h3,{id:"replaceone---thay-th\u1ebf-m\u1ed9t-document",children:[(0,i.jsx)(e.code,{children:"replaceOne()"})," - Thay th\u1ebf m\u1ed9t document"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"C\xfa ph\xe1p:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"db.collection.replaceOne(filter, replacement, options);\n"})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"V\xed d\u1ee5 c\u01a1 b\u1ea3n:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// Document g\u1ed1c\ndb.users.insertOne({\n    _id: 1,\n    name: "Nguy\u1ec5n V\u0103n A",\n    email: "old@email.com",\n    age: 25,\n    status: "active"\n})\n\n// Thay th\u1ebf to\xe0n b\u1ed9 document\ndb.users.replaceOne(\n    { _id: 1 },\n    {\n        name: "Nguy\u1ec5n V\u0103n A Updated",\n        email: "new@email.com",\n        status: "inactive",\n        updatedAt: new Date()\n    }\n)\n\n// K\u1ebft qu\u1ea3:\n{\n    "acknowledged": true,\n    "matchedCount": 1,\n    "modifiedCount": 1\n}\n'})}),"\n",(0,i.jsx)(e.admonition,{title:"L\u01b0u \xfd quan tr\u1ecdng",type:"caution",children:(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["To\xe0n b\u1ed9 document \u0111\u01b0\u1ee3c thay th\u1ebf, ch\u1ec9 gi\u1eef l\u1ea1i ",(0,i.jsx)(e.code,{children:"_id"})]}),"\n",(0,i.jsx)(e.li,{children:"C\xe1c tr\u01b0\u1eddng kh\xf4ng c\xf3 trong replacement document s\u1ebd b\u1ecb m\u1ea5t"}),"\n"]})}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"V\xed d\u1ee5:"}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// Document g\u1ed1c trong products collection\n{\n    _id: "P001",\n    name: "Laptop Old Model",\n    price: 1000,\n    category: "electronics",\n    inStock: true,\n    createdAt: ISODate("2023-01-01")\n}\n\n// Thay th\u1ebf v\u1edbi document m\u1edbi\ndb.products.replaceOne(\n    { _id: "P001" },\n    {\n        name: "Laptop New Model 2024",\n        price: 1200,\n        specifications: {\n            cpu: "Intel i7",\n            ram: "16GB",\n            storage: "1TB SSD"\n        },\n        updatedAt: new Date()\n    }\n)\n\n// K\u1ebft qu\u1ea3: m\u1ea5t c\xe1c tr\u01b0\u1eddng category, inStock, createdAt\n'})}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.h2,{id:"update-document",children:"Update document"}),"\n",(0,i.jsxs)(e.h3,{id:"updateone---c\u1eadp-nh\u1eadt-m\u1ed9t-document",children:[(0,i.jsx)(e.code,{children:"updateOne()"})," - C\u1eadp nh\u1eadt m\u1ed9t document"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"C\xfa ph\xe1p:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"db.collection.updateOne(filter, update, options);\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"updatemany---c\u1eadp-nh\u1eadt-nhi\u1ec1u-documents",children:[(0,i.jsx)(e.code,{children:"updateMany()"})," - C\u1eadp nh\u1eadt nhi\u1ec1u documents"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"C\xfa ph\xe1p:"}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"db.collection.updateMany(filter, update, options);\n"})}),"\n",(0,i.jsx)(e.h2,{id:"c\xe1c-to\xe1n-t\u1eed-update-quan-tr\u1ecdng",children:"C\xe1c to\xe1n t\u1eed update quan tr\u1ecdng"}),"\n",(0,i.jsxs)(e.h3,{id:"set---thi\u1ebft-l\u1eadp-gi\xe1-tr\u1ecb-tr\u01b0\u1eddng",children:[(0,i.jsx)(e.code,{children:"$set"})," - Thi\u1ebft l\u1eadp gi\xe1 tr\u1ecb tr\u01b0\u1eddng"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// C\u1eadp nh\u1eadt m\u1ed9t tr\u01b0\u1eddng\ndb.users.updateOne({ _id: 1 }, { $set: { status: "inactive" } });\n\n// C\u1eadp nh\u1eadt nhi\u1ec1u tr\u01b0\u1eddng\ndb.users.updateOne(\n  { _id: 1 },\n  {\n    $set: {\n      status: "active",\n      lastLogin: new Date(),\n      loginCount: 0,\n    },\n  }\n);\n\n// C\u1eadp nh\u1eadt nested fields\ndb.products.updateOne(\n  { _id: "P001" },\n  {\n    $set: {\n      "specifications.ram": "32GB",\n      "specifications.display": "15.6 inch",\n    },\n  }\n);\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"unset---x\xf3a-tr\u01b0\u1eddng",children:[(0,i.jsx)(e.code,{children:"$unset"})," - X\xf3a tr\u01b0\u1eddng"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// X\xf3a m\u1ed9t tr\u01b0\u1eddng\ndb.users.updateOne({ _id: 1 }, { $unset: { temporaryField: "" } });\n\n// X\xf3a nhi\u1ec1u tr\u01b0\u1eddng\ndb.users.updateOne(\n  { _id: 1 },\n  {\n    $unset: {\n      oldField1: "",\n      oldField2: "",\n      "nested.oldField": "",\n    },\n  }\n);\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"inc---t\u0103nggi\u1ea3m-gi\xe1-tr\u1ecb-s\u1ed1",children:[(0,i.jsx)(e.code,{children:"$inc"})," - T\u0103ng/gi\u1ea3m gi\xe1 tr\u1ecb s\u1ed1"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// T\u0103ng gi\xe1 tr\u1ecb\ndb.products.updateOne(\n  { _id: "P001" },\n  { $inc: { stock: 10 } } // T\u0103ng stock l\xean 10\n);\n\n// Gi\u1ea3m gi\xe1 tr\u1ecb\ndb.products.updateOne(\n  { _id: "P001" },\n  { $inc: { stock: -5 } } // Gi\u1ea3m stock 5\n);\n\n// C\u1eadp nh\u1eadt nhi\u1ec1u tr\u01b0\u1eddng\ndb.users.updateOne(\n  { _id: 1 },\n  {\n    $inc: {\n      loginCount: 1,\n      points: 50,\n    },\n  }\n);\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"mul---nh\xe2n-gi\xe1-tr\u1ecb",children:[(0,i.jsx)(e.code,{children:"$mul"})," - Nh\xe2n gi\xe1 tr\u1ecb"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// Nh\xe2n gi\xe1 tr\u1ecb v\u1edbi h\u1ec7 s\u1ed1\ndb.products.updateOne(\n  { _id: "P001" },\n  { $mul: { price: 1.1 } } // T\u0103ng gi\xe1 10%\n);\n\n// Gi\u1ea3m gi\xe1 20%\ndb.products.updateOne({ _id: "P001" }, { $mul: { price: 0.8 } });\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"rename---\u0111\u1ed5i-t\xean-tr\u01b0\u1eddng",children:[(0,i.jsx)(e.code,{children:"$rename"})," - \u0110\u1ed5i t\xean tr\u01b0\u1eddng"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// \u0110\u1ed5i t\xean m\u1ed9t tr\u01b0\u1eddng\ndb.users.updateOne({ _id: 1 }, { $rename: { oldFieldName: "newFieldName" } });\n\n// \u0110\u1ed5i t\xean nested field\ndb.users.updateOne(\n  { _id: 1 },\n  { $rename: { "contact.phone": "contact.mobile" } }\n);\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"min-v\xe0-max",children:[(0,i.jsx)(e.code,{children:"$min"})," v\xe0 ",(0,i.jsx)(e.code,{children:"$max"})]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"// $min - Ch\u1ec9 c\u1eadp nh\u1eadt n\u1ebfu gi\xe1 tr\u1ecb m\u1edbi NH\u1ece H\u01a0N\ndb.scores.updateOne(\n  { _id: 1 },\n  { $min: { highScore: 1500 } } // Ch\u1ec9 c\u1eadp nh\u1eadt n\u1ebfu 1500 < highScore hi\u1ec7n t\u1ea1i\n);\n\n// $max - Ch\u1ec9 c\u1eadp nh\u1eadt n\u1ebfu gi\xe1 tr\u1ecb m\u1edbi L\u1edaN H\u01a0N\ndb.scores.updateOne(\n  { _id: 1 },\n  { $max: { lowScore: 500 } } // Ch\u1ec9 c\u1eadp nh\u1eadt n\u1ebfu 500 > lowScore hi\u1ec7n t\u1ea1i\n);\n"})}),"\n",(0,i.jsx)(e.h2,{id:"to\xe1n-t\u1eed-update-v\u1edbi-m\u1ea3ng",children:"To\xe1n t\u1eed update v\u1edbi m\u1ea3ng"}),"\n",(0,i.jsxs)(e.h3,{id:"push---th\xeam-ph\u1ea7n-t\u1eed-v\xe0o-m\u1ea3ng",children:[(0,i.jsx)(e.code,{children:"$push"})," - Th\xeam ph\u1ea7n t\u1eed v\xe0o m\u1ea3ng"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// Th\xeam m\u1ed9t ph\u1ea7n t\u1eed\ndb.posts.updateOne({ _id: 1 }, { $push: { tags: "mongodb" } });\n\n// Th\xeam nhi\u1ec1u ph\u1ea7n t\u1eed v\u1edbi $each\ndb.posts.updateOne(\n  { _id: 1 },\n  {\n    $push: {\n      tags: {\n        $each: ["database", "nosql", "tutorial"],\n      },\n    },\n  }\n);\n\n// K\u1ebft h\u1ee3p v\u1edbi $sort v\xe0 $slice\ndb.posts.updateOne(\n  { _id: 1 },\n  {\n    $push: {\n      comments: {\n        $each: [{ user: "newUser", text: "Great post!" }],\n        $sort: { createdAt: -1 },\n        $slice: 10, // Gi\u1eef ch\u1ec9 10 comments m\u1edbi nh\u1ea5t\n      },\n    },\n  }\n);\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"addtoset---th\xeam-ph\u1ea7n-t\u1eed-n\u1ebfu-ch\u01b0a-t\u1ed3n-t\u1ea1i",children:[(0,i.jsx)(e.code,{children:"$addToSet"})," - Th\xeam ph\u1ea7n t\u1eed n\u1ebfu ch\u01b0a t\u1ed3n t\u1ea1i"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// Th\xeam n\u1ebfu ch\u01b0a t\u1ed3n t\u1ea1i\ndb.users.updateOne({ _id: 1 }, { $addToSet: { roles: "admin" } });\n\n// Th\xeam nhi\u1ec1u ph\u1ea7n t\u1eed\ndb.users.updateOne(\n  { _id: 1 },\n  {\n    $addToSet: {\n      roles: {\n        $each: ["editor", "viewer", "admin"], // "admin" s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c th\xeam l\u1ea1i\n      },\n    },\n  }\n);\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"pull---x\xf3a-ph\u1ea7n-t\u1eed-kh\u1ecfi-m\u1ea3ng",children:[(0,i.jsx)(e.code,{children:"$pull"})," - X\xf3a ph\u1ea7n t\u1eed kh\u1ecfi m\u1ea3ng"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// X\xf3a ph\u1ea7n t\u1eed theo gi\xe1 tr\u1ecb\ndb.users.updateOne({ _id: 1 }, { $pull: { roles: "viewer" } });\n\n// X\xf3a v\u1edbi \u0111i\u1ec1u ki\u1ec7n ph\u1ee9c t\u1ea1p\ndb.posts.updateOne(\n  { _id: 1 },\n  {\n    $pull: {\n      comments: {\n        user: "spamUser",\n        likes: { $lt: 0 },\n      },\n    },\n  }\n);\n'})}),"\n",(0,i.jsxs)(e.h3,{id:"pop---x\xf3a-ph\u1ea7n-t\u1eed-\u0111\u1ea7ucu\u1ed1i-m\u1ea3ng",children:[(0,i.jsx)(e.code,{children:"$pop"})," - X\xf3a ph\u1ea7n t\u1eed \u0111\u1ea7u/cu\u1ed1i m\u1ea3ng"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:"// X\xf3a ph\u1ea7n t\u1eed cu\u1ed1i c\xf9ng\ndb.users.updateOne({ _id: 1 }, { $pop: { recentSearches: 1 } });\n\n// X\xf3a ph\u1ea7n t\u1eed \u0111\u1ea7u ti\xean\ndb.users.updateOne({ _id: 1 }, { $pop: { recentSearches: -1 } });\n"})}),"\n",(0,i.jsxs)(e.h3,{id:"arrayfilters---l\u1ecdc-ph\u1ea7n-t\u1eed-trong-m\u1ea3ng",children:[(0,i.jsx)(e.code,{children:"arrayFilters"})," - L\u1ecdc ph\u1ea7n t\u1eed trong m\u1ea3ng"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'// Document g\u1ed1c\n{\n    _id: 1,\n    items: [\n        { id: 1, name: "item1", status: "active" },\n        { id: 2, name: "item2", status: "inactive" },\n        { id: 3, name: "item3", status: "active" }\n    ]\n}\n\n// C\u1eadp nh\u1eadt c\xe1c ph\u1ea7n t\u1eed c\u1ee5 th\u1ec3 trong m\u1ea3ng\ndb.collection.updateOne(\n    { _id: 1 },\n    { $set: { "items.$[elem].status": "archived" } },\n    {\n        arrayFilters: [\n            { "elem.status": "inactive" }\n        ]\n    }\n)\n// Ch\u1ec9 c\u1eadp nh\u1eadt item c\xf3 status = "inactive"\n'})})]})}function u(n={}){const{wrapper:e}={...(0,c.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>s,x:()=>a});var d=t(6540);const i={},c=d.createContext(i);function s(n){const e=d.useContext(c);return d.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function a(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:s(n.components),d.createElement(c.Provider,{value:e},n.children)}}}]);