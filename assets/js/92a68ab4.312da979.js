"use strict";(self.webpackChunknextjs=self.webpackChunknextjs||[]).push([[380],{6199:(n,e,d)=>{d.r(e),d.d(e,{assets:()=>l,contentTitle:()=>t,default:()=>x,frontMatter:()=>r,metadata:()=>c,toc:()=>h});const c=JSON.parse('{"id":"crud/findOneAnd","title":"findOneAnd...","description":"Nh\xf3m findOneAnd... l\xe0 g\xec?","source":"@site/docs/crud/findOneAnd.md","sourceDirName":"crud","slug":"/crud/findOneAnd","permalink":"/mongodb/crud/findOneAnd","draft":false,"unlisted":false,"tags":[],"version":"current","sidebarPosition":12,"frontMatter":{"sidebar_position":12},"sidebar":"tutorialSidebar","previous":{"title":"Evaluation Query Operators","permalink":"/mongodb/crud/evaluation-query-operators"}}');var i=d(4848),s=d(8453);const r={sidebar_position:12},t="findOneAnd...",l={},h=[{value:"Nh\xf3m <em>findOneAnd...</em> l\xe0 g\xec?",id:"nh\xf3m-findoneand-l\xe0-g\xec",level:2},{value:"So s\xe1nh v\u1edbi <code>updateOne</code>, <code>replaceOne</code>, <code>deleteOne</code>",id:"so-s\xe1nh-v\u1edbi-updateone-replaceone-deleteone",level:2},{value:"<code>findOneAndUpdate</code> vs <code>updateOne</code>",id:"findoneandupdate-vs-updateone",level:3},{value:"<code>findOneAndReplace</code> vs <code>replaceOne</code>",id:"findoneandreplace-vs-replaceone",level:3},{value:"<code>findOneAndDelete</code> vs <code>deleteOne</code>",id:"findoneanddelete-vs-deleteone",level:3},{value:"Khi n\xe0o d\xf9ng c\xe1i n\xe0o?",id:"khi-n\xe0o-d\xf9ng-c\xe1i-n\xe0o",level:2}];function o(n){const e={code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,s.R)(),...n.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.header,{children:(0,i.jsx)(e.h1,{id:"findoneand",children:"findOneAnd..."})}),"\n",(0,i.jsxs)(e.h2,{id:"nh\xf3m-findoneand-l\xe0-g\xec",children:["Nh\xf3m ",(0,i.jsx)(e.em,{children:"findOneAnd..."})," l\xe0 g\xec?"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["C\xe1c h\xe0m:","\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"findOneAndUpdate()"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"findOneAndReplace()"})}),"\n",(0,i.jsx)(e.li,{children:(0,i.jsx)(e.strong,{children:"findOneAndDelete()"})}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:["\ud83d\udc49 \u0110\u1ec1u c\xf3 c\u01a1 ch\u1ebf ",(0,i.jsx)(e.strong,{children:'"find + modify + return document"'})," ."]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsx)(e.p,{children:"N\xf3i c\xe1ch kh\xe1c:"}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["Ch\xfang ",(0,i.jsx)(e.strong,{children:"t\xecm m\u1ed9t document"}),","]}),"\n",(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:"th\u1ef1c hi\u1ec7n h\xe0nh \u0111\u1ed9ng"}),","]}),"\n",(0,i.jsxs)(e.li,{children:["v\xe0 ",(0,i.jsx)(e.strong,{children:"tr\u1ea3 v\u1ec1 document tr\u01b0\u1edbc ho\u1eb7c sau khi s\u1eeda"})," (t\xf9y option)."]}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["\u0110\xe2y l\xe0 ",(0,i.jsx)(e.strong,{children:"atomic operation"})," (theo c\xe1ch c\u1ee7a MongoDB \u2014 d\xf9ng ",(0,i.jsx)(e.code,{children:"findAndModify"})," ph\xeda server)."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["N\xf3 lu\xf4n ",(0,i.jsx)(e.strong,{children:"ch\u1ec9 t\xe1c \u0111\u1ed9ng \u0111\xfang 1 document"})," , document \u0111\u1ea7u ti\xean ph\xf9 h\u1ee3p."]}),"\n"]}),"\n",(0,i.jsxs)(e.li,{children:["\n",(0,i.jsxs)(e.p,{children:["V\xed d\u1ee5 ",(0,i.jsx)(e.code,{children:"findOneAndUpdate"})]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{className:"language-js",children:'const doc = await db\n  .collection("users")\n  .findOneAndUpdate(\n    { email: "test@gmail.com" },\n    { $set: { age: 22 } },\n    { returnDocument: "after" }\n  );\n'})}),"\n",(0,i.jsx)(e.p,{children:"\u27a1\ufe0f Tr\u1ea3 v\u1ec1 document sau khi update."}),"\n",(0,i.jsxs)(e.h2,{id:"so-s\xe1nh-v\u1edbi-updateone-replaceone-deleteone",children:["So s\xe1nh v\u1edbi ",(0,i.jsx)(e.code,{children:"updateOne"}),", ",(0,i.jsx)(e.code,{children:"replaceOne"}),", ",(0,i.jsx)(e.code,{children:"deleteOne"})]}),"\n",(0,i.jsxs)(e.h3,{id:"findoneandupdate-vs-updateone",children:[(0,i.jsx)(e.code,{children:"findOneAndUpdate"})," vs ",(0,i.jsx)(e.code,{children:"updateOne"})]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Ti\xeau ch\xed"}),(0,i.jsx)(e.th,{children:"findOneAndUpdate"}),(0,i.jsx)(e.th,{children:"updateOne"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"T\xe1c \u0111\u1ed9ng"})}),(0,i.jsx)(e.td,{children:"1 document"}),(0,i.jsx)(e.td,{children:"1 document"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Tr\u1ea3 v\u1ec1 document?"})}),(0,i.jsx)(e.td,{children:"\u2714\ufe0f C\xf3 (before/after)"}),(0,i.jsx)(e.td,{children:"\u274c Kh\xf4ng"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"M\u1ee5c \u0111\xedch ch\xednh"})}),(0,i.jsx)(e.td,{children:"L\u1ea5y b\u1ea3n ghi v\u1eeba update"}),(0,i.jsx)(e.td,{children:"Ch\u1ec9 update, kh\xf4ng c\u1ea7n d\u1eef li\u1ec7u m\u1edbi"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Underlying command"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"findAndModify"})}),(0,i.jsx)(e.td,{children:(0,i.jsx)(e.code,{children:"update"})})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"T\u1ed1c \u0111\u1ed9"})}),(0,i.jsx)(e.td,{children:"Ch\u1eadm h\u01a1n ch\xfat (v\xec c\u1ea7n return document)"}),(0,i.jsx)(e.td,{children:"Nhanh h\u01a1n"})]})]})]}),"\n",(0,i.jsxs)(e.h3,{id:"findoneandreplace-vs-replaceone",children:[(0,i.jsx)(e.code,{children:"findOneAndReplace"})," vs ",(0,i.jsx)(e.code,{children:"replaceOne"})]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Ti\xeau ch\xed"}),(0,i.jsx)(e.th,{children:"findOneAndReplace"}),(0,i.jsx)(e.th,{children:"replaceOne"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Tr\u1ea3 v\u1ec1 document?"})}),(0,i.jsx)(e.td,{children:"\u2714\ufe0f C\xf3 (before/after)"}),(0,i.jsx)(e.td,{children:"\u274c Kh\xf4ng"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Replace to\xe0n b\u1ed9 document?"})}),(0,i.jsx)(e.td,{children:"\u2714\ufe0f"}),(0,i.jsx)(e.td,{children:"\u2714\ufe0f"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Khi d\xf9ng"})}),(0,i.jsx)(e.td,{children:"C\u1ea7n tr\u1ea3 v\u1ec1 document c\u0169/m\u1edbi"}),(0,i.jsx)(e.td,{children:"Ch\u1ec9 mu\u1ed1n replace"})]})]})]}),"\n",(0,i.jsxs)(e.h3,{id:"findoneanddelete-vs-deleteone",children:[(0,i.jsx)(e.code,{children:"findOneAndDelete"})," vs ",(0,i.jsx)(e.code,{children:"deleteOne"})]}),"\n",(0,i.jsxs)(e.table,{children:[(0,i.jsx)(e.thead,{children:(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.th,{children:"Ti\xeau ch\xed"}),(0,i.jsx)(e.th,{children:"findOneAndDelete"}),(0,i.jsx)(e.th,{children:"deleteOne"})]})}),(0,i.jsxs)(e.tbody,{children:[(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Tr\u1ea3 v\u1ec1 document b\u1ecb x\xf3a?"})}),(0,i.jsx)(e.td,{children:"\u2714\ufe0f C\xf3"}),(0,i.jsx)(e.td,{children:"\u274c Kh\xf4ng"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"T\xe1c \u0111\u1ed9ng"})}),(0,i.jsx)(e.td,{children:"1 document"}),(0,i.jsx)(e.td,{children:"1 document"})]}),(0,i.jsxs)(e.tr,{children:[(0,i.jsx)(e.td,{children:(0,i.jsx)(e.strong,{children:"Khi d\xf9ng"})}),(0,i.jsx)(e.td,{children:"C\u1ea7n bi\u1ebft n\u1ed9i dung document tr\u01b0\u1edbc khi x\xf3a"}),(0,i.jsx)(e.td,{children:"Ch\u1ec9 c\u1ea7n x\xf3a"})]})]})]}),"\n",(0,i.jsx)(e.h2,{id:"khi-n\xe0o-d\xf9ng-c\xe1i-n\xe0o",children:"Khi n\xe0o d\xf9ng c\xe1i n\xe0o?"}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsxs)(e.strong,{children:["D\xf9ng ",(0,i.jsx)(e.code,{children:"findOneAndUpdate"})," , ",(0,i.jsx)(e.code,{children:"findOneAndDelete"})," , ",(0,i.jsx)(e.code,{children:"findOneAndReplace"})," khi"]}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsxs)(e.li,{children:["C\u1ea7n l\u1ea5y ",(0,i.jsx)(e.strong,{children:"document tr\u01b0\u1edbc"})," khi thay \u0111\u1ed5i \u2192 logging, backup"]}),"\n",(0,i.jsxs)(e.li,{children:["C\u1ea7n l\u1ea5y ",(0,i.jsx)(e.strong,{children:"document sau"})," khi update \u2192 UI tr\u1ea3 v\u1ec1 data m\u1edbi"]}),"\n",(0,i.jsxs)(e.li,{children:["B\u1ea1n mu\u1ed1n th\u1ef1c hi\u1ec7n ",(0,i.jsx)(e.strong,{children:'atomic "find + change + return"'})," trong 1 round-trip"]}),"\n"]}),"\n",(0,i.jsxs)(e.p,{children:[(0,i.jsxs)(e.strong,{children:["D\xf9ng ",(0,i.jsx)(e.code,{children:"updateOne"})," , ",(0,i.jsx)(e.code,{children:"deleteOne"})," , ",(0,i.jsx)(e.code,{children:"replaceOne"})," khi"]}),":"]}),"\n",(0,i.jsxs)(e.ul,{children:["\n",(0,i.jsx)(e.li,{children:"Kh\xf4ng c\u1ea7n n\u1ed9i dung document"}),"\n",(0,i.jsx)(e.li,{children:"Ch\u1ec9 c\u1ea7n bi\u1ebft th\xe0nh c\xf4ng hay th\u1ea5t b\u1ea1i"}),"\n",(0,i.jsx)(e.li,{children:"Mu\u1ed1n hi\u1ec7u n\u0103ng t\u1ed1t h\u01a1n"}),"\n",(0,i.jsx)(e.li,{children:"Ch\u1ea1y t\xe1c v\u1ee5 n\u1ec1n, cronjob, migration\u2026"}),"\n"]})]})}function x(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,i.jsx)(e,{...n,children:(0,i.jsx)(o,{...n})}):o(n)}},8453:(n,e,d)=>{d.d(e,{R:()=>r,x:()=>t});var c=d(6540);const i={},s=c.createContext(i);function r(n){const e=c.useContext(s);return c.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function t(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(i):n.components||i:r(n.components),c.createElement(s.Provider,{value:e},n.children)}}}]);